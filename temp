Private Sub Worksheet_Change(ByVal Target As Range)
    Dim ws As Worksheet
    Set ws = Me

    ' 當使用者改變 B4:B10 (通路清單) 或 C4 (年期) 時觸發
    If Intersect(Target, ws.Range("B4:B10,C4")) Is Nothing Then Exit Sub
    Application.EnableEvents = False
    Application.ScreenUpdating = False
    
    '=== 基本設定 ===
    Dim outputStartRow As Long
    outputStartRow = 11 ' 產出起始列
    Dim currentRow As Long
    currentRow = outputStartRow
    
    ' 清空舊產出（B11 之下）
    ws.Rows(outputStartRow & ":" & ws.Rows.Count).ClearContents
    ws.Rows(outputStartRow & ":" & ws.Rows.Count).ClearFormats

    ' 取得輸入資料
    Dim i As Long,通路 As String, 年期 As Variant
    Dim 通路清單 As Collection
    Set 通路清單 = New Collection
    
    ' 將 B4:B10 的通路收集起來（非空值）
    For i = 4 To 10
        If Trim(ws.Cells(i, "B").Value) <> "" Then
            通路清單.Add Trim(ws.Cells(i, "B").Value)
        End If
    Next i
    
    ' 年期可以輸入逗號分隔，例如 2,6
    Dim 年期輸入 As String
    年期輸入 = Trim(ws.Range("C4").Value)
    If 年期輸入 = "" Then GoTo 結束程式
    年期 = Split(年期輸入, ",")
    
    '=== 通路對應範本設定 ===
    Dim 範本範圍 As Range
    Dim 名稱 As String
    
    For Each 通路 In 通路清單
        For i = LBound(年期) To UBound(年期)
            
            ' 標題列
            ws.Cells(currentRow, "B").Value = 通路 & "－" & Trim(年期(i)) & "年期"
            ws.Cells(currentRow, "B").Font.Bold = True
            currentRow = currentRow + 1
            
            ' 根據通路名稱決定範本來源
            Select Case 通路
                Case "業務"
                    Set 範本範圍 = ws.Range("B61:Y65")
                Case "經代"
                    Set 範本範圍 = ws.Range("B66:Y70")
                Case "銀保"
                    Set 範本範圍 = ws.Range("B71:Y79")
                Case "理財"
                    Set 範本範圍 = ws.Range("B80:Y83")
                Case Else
                    GoTo 下一個通路 ' 無此通路名稱則略過
            End Select
            
            ' 複製貼上框框
            範本範圍.Copy
            ws.Cells(currentRow, "B").PasteSpecial xlPasteAll
            currentRow = currentRow + 範本範圍.Rows.Count + 1
            
下一個通路:
        Next i
    Next 通路
    
結束程式:
    Application.CutCopyMode = False
    Application.EnableEvents = True
    Application.ScreenUpdating = True
End Sub