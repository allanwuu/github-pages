Sub FindAllDataValidationLinks()
    Dim ws As Worksheet
    Dim rng As Range, c As Range
    Dim row As Long
    Dim result As Worksheet
    
    ' 建立結果表
    Set result = Sheets.Add
    result.Name = "DV檢查結果"
    result.Range("A1:D1") = Array("Sheet", "Cell", "Validation Type", "Source")
    row = 2
    
    ' 掃描所有工作表
    For Each ws In ThisWorkbook.Worksheets
        On Error Resume Next
        Set rng = ws.Cells.SpecialCells(xlCellTypeAllValidation)
        On Error GoTo 0
        
        If Not rng Is Nothing Then
            For Each c In rng
                If c.Validation.Type <> 0 Then
                    result.Cells(row, 1).Value = ws.Name
                    result.Cells(row, 2).Value = c.Address
                    result.Cells(row, 3).Value = c.Validation.Type
                    result.Cells(row, 4).Value = c.Validation.Formula1
                    
                    row = row + 1
                End If
            Next c
        End If
        
        Set rng = Nothing
    Next ws
    
    MsgBox "掃描完成！請查看「DV檢查結果」工作表。"
End Sub
